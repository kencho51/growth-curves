<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Growth Chart Plotter - WHO/CDC & Hong Kong 2020 Standards | Height Percentile Calculator</title>
    <meta name="title" content="Growth Chart Plotter - WHO/CDC & Hong Kong 2020 Standards | Height Percentile Calculator">
    <meta name="description" content="Interactive growth chart tool for children 0-18 years. Plot height percentiles using WHO/CDC International or Hong Kong 2020 growth standards. Free online height percentile calculator for boys and girls.">
    <meta name="keywords" content="growth chart, height percentile, children growth, WHO growth standards, Hong Kong growth chart, pediatric growth, height calculator, child development, growth percentile calculator">
    <meta name="author" content="Growth Chart Tool">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://growth-curves.superbrains.cc">
    <meta property="og:title" content="Growth Chart Plotter - WHO/CDC & Hong Kong 2020 Standards">
    <meta property="og:description" content="Interactive growth chart tool for children 0-18 years. Plot height percentiles using WHO/CDC International or Hong Kong 2020 growth standards.">
    <!-- <meta property="og:image" content="https://growth-curves.superbrains.cc/growth-chart-preview.png"> -->
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://growth-curves.superbrains.cc/">
    <meta property="twitter:title" content="Growth Chart Plotter - WHO/CDC & Hong Kong 2020 Standards">
    <meta property="twitter:description" content="Interactive growth chart tool for children 0-18 years. Plot height percentiles using WHO/CDC International or Hong Kong 2020 growth standards.">
    <!-- <meta property="twitter:image" content="https://growth-curves.superbrains.cc/growth-chart-preview.png"> -->
    
    <!-- Additional SEO Meta Tags -->
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    <meta name="distribution" content="global">
    <meta name="rating" content="general">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://growth-curves.superbrains.cc">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Growth Chart Plotter",
        "description": "Interactive growth chart tool for children 0-18 years using WHO/CDC International or Hong Kong 2020 growth standards",
        "url": "https://growth-curves.superbrains.cc/",
        "applicationCategory": "HealthApplication",
        "operatingSystem": "Any",
        "permissions": "none",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "author": {
            "@type": "Organization",
            "name": "Growth Chart Tool"
        },
        "provider": {
            "@type": "Organization",
            "name": "Growth Chart Tool"
        },
        "inLanguage": "en",
        "isAccessibleForFree": true,
        "keywords": ["growth chart", "height percentile", "children growth", "WHO standards", "Hong Kong growth standards"],
        "about": {
            "@type": "MedicalCondition",
            "name": "Child Growth and Development"
        }
    }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .input-section {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: end;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        
        input, select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            height: fit-content;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .button-secondary {
            background-color: #2196F3;
        }
        
        .button-secondary:hover {
            background-color: #1976D2;
        }
        
        .button-danger {
            background-color: #f44336;
        }
        
        .button-danger:hover {
            background-color: #d32f2f;
        }
        
        .button-small {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .chart-container {
            position: relative;
            height: 600px;
            margin-top: 20px;
        }
        
        .info-box {
            background-color: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid #4CAF50;
        }
        
        .error {
            background-color: #ffebee;
            border-left-color: #f44336;
            color: #c62828;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 3px;
        }
        
        /* Saved Points Styles */
        .saved-points-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
        }
        
        .saved-points-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .saved-points-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .saved-point-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background-color: white;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        
        .saved-point-info {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .saved-point-label {
            font-weight: bold;
            color: #333;
            min-width: 120px;
        }
        
        .saved-point-details {
            color: #666;
            font-size: 14px;
        }
        
        .saved-point-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .no-saved-points {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Growth Chart Plotter</h1>
            <p style="text-align: center; color: #666; margin-top: -15px; margin-bottom: 30px;">Interactive height percentile calculator for children 0-18 years using Hong Kong 2020 or WHO/CDC International growth standards</p>
        </header>
        
        <div class="input-section">
            <div class="input-group">
                <label for="standard">Growth Standard:</label>
                <select id="standard">
                    <option value="who_cdc">WHO/CDC International</option>
                    <option value="hk2020" selected>Hong Kong 2020</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="gender">Gender:</label>
                <select id="gender">
                    <option value="boy">Boy</option>
                    <option value="girl">Girl</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="age">Age (years):</label>
                <input type="number" id="age" min="0" max="18" step="0.1" placeholder="0-18">
            </div>
            
            <div class="input-group">
                <label for="height">Height (cm):</label>
                <input type="number" id="height" min="30" max="200" step="0.1" placeholder="30-200">
            </div>
            
            <div class="input-group">
                <label for="pointLabel">Label (optional):</label>
                <input type="text" id="pointLabel" placeholder="e.g., John - 6 months" maxlength="30">
            </div>
            
            <button onclick="plotPoint()">Plot on Chart</button>
            <button onclick="savePoint()" class="button-secondary">Save Point</button>
        </div>
        
        <div class="chart-container">
            <canvas id="growthChart"></canvas>
        </div>
        
        <div id="loading" class="info-box" style="background-color: #e3f2fd; border-left-color: #2196f3;">
            Loading growth chart data...
        </div>
        
        <div id="info" class="info-box" style="display: none;"></div>
        
        <div id="legend" class="legend">
            <!-- Legend will be populated dynamically -->
        </div>
        
        <!-- Saved Points Management Section -->
        <div class="saved-points-section" id="savedPointsSection" style="display: none;">
            <div class="saved-points-header">
                <h3 style="margin: 0; color: #333;">Saved Data Points</h3>
                <button onclick="clearAllPoints()" class="button-danger button-small">Clear All</button>
            </div>
            <div class="saved-points-list" id="savedPointsList">
                <!-- Saved points will be populated dynamically -->
            </div>
        </div>
        
        <section class="usage-guide" style="margin-top: 30px; padding: 20px; background-color: #f0f8ff; border-radius: 5px; border-left: 4px solid #007bff;">
            <h2 style="margin-top: 0; color: #333; font-size: 18px;">How to Use This Growth Chart Calculator</h2>
            <ol style="color: #555; line-height: 1.6;">
                <li><strong>Select Growth Standard:</strong> Choose between WHO/CDC International or Hong Kong 2020 standards</li>
                <li><strong>Choose Gender:</strong> Select boy or girl</li>
                <li><strong>Enter Age:</strong> Input age in years (0-18 years, accepts decimals like 5.5)</li>
                <li><strong>Enter Height:</strong> Input height in centimeters</li>
                <li><strong>Add Label (Optional):</strong> Give a name to track this measurement (e.g., "John - 6 months")</li>
                <li><strong>Plot Point:</strong> Click "Plot on Chart" to see where the measurement falls</li>
                <li><strong>Save Point:</strong> Click "Save Point" to permanently save this measurement for tracking</li>
                <li><strong>Track Growth:</strong> Add multiple points over time to track growth patterns</li>
            </ol>
        </section>

        <section class="info-section" style="margin-top: 20px; padding: 20px; background-color: #f8f9fa; border-radius: 5px; font-size: 14px;">
            <h3 style="margin-top: 0; color: #555;">Data Sources</h3>
                <p><strong>WHO/CDC International:</strong> Based on the WHO Child Growth Standards (2006) developed from the WHO Multicentre Growth Reference Study (1997-2003) conducted in 6 countries (Brazil, Ghana, India, Norway, Oman, USA). Represents optimal growth under ideal health conditions.</p>
                <p><strong>Hong Kong 2020:</strong> Based on the Hong Kong Growth Survey 2020-22 conducted by Chinese University of Hong Kong and University of Hong Kong. Represents growth patterns of contemporary Hong Kong children of Chinese ethnicity.</p>
                <p><em>Note: This is a tool for reference only. Always consult healthcare professionals for proper growth assessment and medical advice.</em></p>
            </div>

            <div class="disclaimer" style="background-color: #fff3cd; padding: 15px; border-radius: 4px; border-left: 4px solid #ffc107;">
                <h3 style="color: #856404; font-size: 16px; margin-top: 0; margin-bottom: 8px;">Important Medical Disclaimer</h3>
                <p style="color: #856404; margin-bottom: 0;"><em>This growth chart calculator is for reference and educational purposes only. It should not replace professional medical advice, diagnosis, or treatment. Always consult qualified healthcare professionals for proper growth assessment, medical advice, and any concerns about your child's development.</em></p>
            </div>
        </section>
    </div>

    <script>
        let chart;
        let growthData = null; // Will be loaded from external JSON files
        let savedDataPoints = []; // Array to store multiple saved points
        let currentPlotPoint = null; // Temporarily plotted point (before saving)

        // Colors for different saved points
        const POINT_COLORS = [
            '#ff3838', '#2196F3', '#4CAF50', '#FF9800', '#9C27B0',
            '#607D8B', '#795548', '#E91E63', '#009688', '#FFC107',
            '#3F51B5', '#8BC34A', '#FF5722', '#673AB7', '#CDDC39'
        ];

        // Data loading functions
        async function loadGrowthData() {
            try {
                // Load both data files in parallel
                const [whoCdcResponse, hk2020Response] = await Promise.all([
                    fetch('./data/who-cdc-growth-data.json'),
                    fetch('./data/hk2020-growth-data.json')
                ]);

                if (!whoCdcResponse.ok || !hk2020Response.ok) {
                    throw new Error('Failed to load growth data files');
                }

                const whoCdcData = await whoCdcResponse.json();
                const hk2020Data = await hk2020Response.json();

                // Combine the data
                growthData = {
                    who_cdc: whoCdcData,
                    hk2020: hk2020Data
                };

                // Hide loading indicator
                document.getElementById('loading').style.display = 'none';
                
                // Load saved points from localStorage
                loadSavedPoints();
                
                // Initialize chart after data is loaded
                initChart();
                updateLegend();
                
                console.log('Growth data loaded successfully');
            } catch (error) {
                console.error('Error loading growth data:', error);
                
                // Hide loading indicator and show error
                document.getElementById('loading').style.display = 'none';
                showInfo('Error loading growth chart data. Please refresh the page.', 'error');
            }
        }

        // Local Storage Functions
        function loadSavedPoints() {
            try {
                const saved = localStorage.getItem('growthChart_savedPoints');
                if (saved) {
                    savedDataPoints = JSON.parse(saved);
                    updateSavedPointsList();
                }
            } catch (error) {
                console.error('Error loading saved points:', error);
                savedDataPoints = [];
            }
        }

        function saveSavedPoints() {
            try {
                localStorage.setItem('growthChart_savedPoints', JSON.stringify(savedDataPoints));
            } catch (error) {
                console.error('Error saving points to localStorage:', error);
            }
        }

        function initChart() {
            const ctx = document.getElementById('growthChart').getContext('2d');
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Age (years)'
                            },
                            min: 0,
                            max: 18
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Height (cm)'
                            },
                            min: 40,
                            max: 200
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'nearest',
                            enable: true,
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(255, 255, 255, 0.3)',
                            borderWidth: 1,
                            cornerRadius: 6,
                            displayColors: true,
                            callbacks: {
                                title: function(context) {
                                    const point = context[0];
                                    if (point.dataset.pointData) {
                                        const data = point.dataset.pointData;
                                        return data.label || `${data.gender === 'boy' ? 'Boy' : 'Girl'} - ${data.age} years`;
                                    }
                                    return `Age: ${point.parsed.x} years`;
                                },
                                label: function(context) {
                                    const point = context.dataset.pointData;
                                    if (point) {
                                        return [
                                            `Height: ${point.height} cm`,
                                            `Percentile: ${point.percentile}`,
                                            `Standard: ${point.standard === 'who_cdc' ? 'WHO/CDC' : 'Hong Kong 2020'}`,
                                            `Date: ${point.date}`
                                        ];
                                    }
                                    return `${context.dataset.label}: ${context.parsed.y} cm`;
                                },
                                afterLabel: function(context) {
                                    const datasetLabel = context.dataset.label;
                                    if (datasetLabel.includes('Saved:') || datasetLabel === 'Current Plot') {
                                        return 'Growth measurement';
                                    }
                                    return 'Growth percentile curve';
                                }
                            }
                        }
                    },
                    elements: {
                        point: {
                            radius: 1,
                            hoverRadius: 6,
                            hoverBorderWidth: 2
                        },
                        line: {
                            borderWidth: 2,
                            hoverBorderWidth: 3
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    }
                }
            });
            
            updateChart();
        }

        function updateLegend() {
            const standard = document.getElementById('standard').value;
            const legendDiv = document.getElementById('legend');
            
            const legendData = standard === 'who_cdc' ? {
                'p3': { color: '#ff6b6b', label: '3rd Percentile' },
                'p10': { color: '#feca57', label: '10th Percentile' },
                'p25': { color: '#48dbfb', label: '25th Percentile' },
                'p50': { color: '#0abde3', label: '50th Percentile (Median)' },
                'p75': { color: '#48dbfb', label: '75th Percentile' },
                'p90': { color: '#feca57', label: '90th Percentile' },
                'p97': { color: '#ff6b6b', label: '97th Percentile' }
            } : {
                'p0_4': { color: '#d63031', label: '0.4th Percentile' },
                'p2': { color: '#e17055', label: '2nd Percentile' },
                'p9': { color: '#fdcb6e', label: '9th Percentile' },
                'p25': { color: '#74b9ff', label: '25th Percentile' },
                'p50': { color: '#0984e3', label: '50th Percentile (Median)' },
                'p75': { color: '#6c5ce7', label: '75th Percentile' },
                'p91': { color: '#a29bfe', label: '91st Percentile' },
                'p98': { color: '#fd79a8', label: '98th Percentile' },
                'p99_6': { color: '#e84393', label: '99.6th Percentile' }
            };
            
            legendDiv.innerHTML = '';
            Object.entries(legendData).forEach(([key, data]) => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background-color: ${data.color};"></div>
                    <span>${data.label}</span>
                `;
                legendDiv.appendChild(legendItem);
            });
        }

        function updateChart() {
            // Check if data is loaded
            if (!growthData) {
                console.log('Growth data not yet loaded, skipping chart update');
                return;
            }
            
            const standard = document.getElementById('standard').value;
            const gender = document.getElementById('gender').value;
            const data = growthData[standard][gender];
            
            const colors = standard === 'who_cdc' ? {
                p3: '#ff6b6b',
                p10: '#feca57',
                p25: '#48dbfb',
                p50: '#0abde3',
                p75: '#48dbfb',
                p90: '#feca57',
                p97: '#ff6b6b'
            } : {
                p0_4: '#d63031',
                p2: '#e17055',
                p9: '#fdcb6e',
                p25: '#74b9ff',
                p50: '#0984e3',
                p75: '#6c5ce7',
                p91: '#a29bfe',
                p98: '#fd79a8',
                p99_6: '#e84393'
            };

            chart.data.datasets = [];
            
            // Add percentile lines
            Object.keys(data.percentiles).forEach(percentile => {
                const percentileData = data.ages.map((age, index) => ({
                    x: age / 12, // Convert months to years for display
                    y: data.percentiles[percentile][index]
                }));
                
                let label = percentile.replace('p', '').replace('_', '.') + 'th Percentile';
                if (percentile === 'p50') label += ' (Median)';
                
                chart.data.datasets.push({
                    label: label,
                    data: percentileData,
                    borderColor: colors[percentile],
                    backgroundColor: colors[percentile],
                    borderWidth: percentile === 'p50' ? 3 : 2,
                    fill: false,
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 4
                });
            });
            
            // Add saved data points (each as its own dataset)
            savedDataPoints.forEach((point, index) => {
                const color = POINT_COLORS[index % POINT_COLORS.length];
                chart.data.datasets.push({
                    label: `Saved: ${point.label || `Point ${index + 1}`}`,
                    data: [{ x: point.age, y: point.height }],
                    backgroundColor: color,
                    borderColor: color,
                    borderWidth: 3,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    pointStyle: 'crossRot',
                    pointRotation: 45,
                    showLine: false,
                    order: -10,
                    pointData: point // Store full point data for tooltips
                });
            });
            
            // Add current plot point if exists (temporary, before saving)
            if (currentPlotPoint) {
                chart.data.datasets.push({
                    label: 'Current Plot',
                    data: [{ x: currentPlotPoint.age, y: currentPlotPoint.height }],
                    backgroundColor: '#FF6B35',
                    borderColor: '#FF6B35',
                    borderWidth: 3,
                    pointRadius: 7,
                    pointHoverRadius: 9,
                    pointStyle: 'crossRot',
                    pointRotation: 45,
                    showLine: false,
                    order: -20,
                    pointData: currentPlotPoint // Store full point data for tooltips
                });
            }
            
            updateLegend();
            chart.update();
        }

        function plotPoint() {
            // Check if data is loaded
            if (!growthData) {
                showInfo('Growth data is still loading. Please wait a moment and try again.', 'error');
                return;
            }
            
            const standard = document.getElementById('standard').value;
            const gender = document.getElementById('gender').value;
            const ageYears = parseFloat(document.getElementById('age').value);
            const height = parseFloat(document.getElementById('height').value);
            const label = document.getElementById('pointLabel').value.trim();
            
            // Validation
            if (isNaN(ageYears) || isNaN(height)) {
                showInfo('Please enter valid numbers for age and height.', 'error');
                return;
            }
            
            if (ageYears < 0 || ageYears > 18) {
                showInfo('Age must be between 0 and 18 years.', 'error');
                return;
            }
            
            if (height < 30 || height > 200) {
                showInfo('Height must be between 30 and 200 cm.', 'error');
                return;
            }
            
            // Convert years to months for calculations
            const ageMonths = ageYears * 12;
            
            // Calculate percentile (using months)
            const percentile = calculatePercentile(standard, gender, ageMonths, height);
            
            // Create current plot point (display in years)
            currentPlotPoint = {
                id: Date.now(),
                label: label || null,
                standard: standard,
                gender: gender,
                age: ageYears,
                height: height,
                percentile: percentile,
                date: new Date().toLocaleDateString()
            };
            
            // Update chart
            updateChart();
            
            // Show info
            const standardName = standard === 'who_cdc' ? 'WHO/CDC' : 'Hong Kong 2020';
            showInfo(`Plotted: ${gender === 'boy' ? 'Boy' : 'Girl'}, ${ageYears} years old, ${height} cm tall. Approximately ${percentile} percentile (${standardName} standard). Click "Save Point" to permanently save this measurement.`);
        }

        function savePoint() {
            if (!currentPlotPoint) {
                showInfo('Please plot a point first before saving.', 'error');
                return;
            }
            
            // Add to saved points
            savedDataPoints.push({ ...currentPlotPoint });
            
            // Clear current plot point
            currentPlotPoint = null;
            
            // Save to localStorage
            saveSavedPoints();
            
            // Update displays
            updateChart();
            updateSavedPointsList();
            
            // Clear the form
            document.getElementById('pointLabel').value = '';
            
            showInfo(`Point saved successfully! You now have ${savedDataPoints.length} saved measurement${savedDataPoints.length === 1 ? '' : 's'}.`);
        }

        function deletePoint(pointId) {
            savedDataPoints = savedDataPoints.filter(point => point.id !== pointId);
            saveSavedPoints();
            updateChart();
            updateSavedPointsList();
            
            if (savedDataPoints.length === 0) {
                showInfo('All points cleared.', 'info');
            } else {
                showInfo(`Point deleted. ${savedDataPoints.length} measurement${savedDataPoints.length === 1 ? '' : 's'} remaining.`);
            }
        }

        function clearAllPoints() {
            if (savedDataPoints.length === 0) {
                showInfo('No saved points to clear.', 'error');
                return;
            }
            
            if (confirm(`Are you sure you want to delete all ${savedDataPoints.length} saved measurements? This cannot be undone.`)) {
                savedDataPoints = [];
                currentPlotPoint = null;
                saveSavedPoints();
                updateChart();
                updateSavedPointsList();
                showInfo('All saved measurements have been cleared.', 'info');
            }
        }

        function updateSavedPointsList() {
            const section = document.getElementById('savedPointsSection');
            const list = document.getElementById('savedPointsList');
            
            if (savedDataPoints.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            list.innerHTML = '';
            
            savedDataPoints.forEach((point, index) => {
                const color = POINT_COLORS[index % POINT_COLORS.length];
                const standardName = point.standard === 'who_cdc' ? 'WHO/CDC' : 'HK 2020';
                
                const item = document.createElement('div');
                item.className = 'saved-point-item';
                item.innerHTML = `
                    <div class="saved-point-info">
                        <div style="display: flex; align-items: center;">
                            <div class="saved-point-marker" style="background-color: ${color};"></div>
                            <span class="saved-point-label">${point.label || `Measurement ${index + 1}`}</span>
                        </div>
                        <div class="saved-point-details">
                            ${point.gender === 'boy' ? 'Boy' : 'Girl'} • ${point.age} years • ${point.height} cm • ${point.percentile} percentile • ${standardName} • ${point.date}
                        </div>
                    </div>
                    <button onclick="deletePoint(${point.id})" class="button-danger button-small">Delete</button>
                `;
                list.appendChild(item);
            });
        }

        function calculatePercentile(standard, gender, ageMonths, height) {
            const data = growthData[standard][gender];
            
            // Find the closest age points for interpolation
            let lowerIndex = 0;
            let upperIndex = data.ages.length - 1;
            
            for (let i = 0; i < data.ages.length - 1; i++) {
                if (ageMonths >= data.ages[i] && ageMonths <= data.ages[i + 1]) {
                    lowerIndex = i;
                    upperIndex = i + 1;
                    break;
                }
            }
            
            // Interpolate percentile values for the given age
            const ageFactor = upperIndex === lowerIndex ? 0 : (ageMonths - data.ages[lowerIndex]) / (data.ages[upperIndex] - data.ages[lowerIndex]);
            
            // Different percentile structures for different standards
            const percentiles = standard === 'who_cdc' 
                ? ['p3', 'p10', 'p25', 'p50', 'p75', 'p90', 'p97']
                : ['p0_4', 'p2', 'p9', 'p25', 'p50', 'p75', 'p91', 'p98', 'p99_6'];
            
            const percentileValues = standard === 'who_cdc'
                ? [3, 10, 25, 50, 75, 90, 97]
                : [0.4, 2, 9, 25, 50, 75, 91, 98, 99.6];
            
            for (let i = 0; i < percentiles.length; i++) {
                const lowerHeight = data.percentiles[percentiles[i]][lowerIndex];
                const upperHeight = data.percentiles[percentiles[i]][upperIndex];
                const interpolatedHeight = lowerHeight + ageFactor * (upperHeight - lowerHeight);
                
                if (height <= interpolatedHeight) {
                    if (i === 0) return `<${percentileValues[i]}th`;
                    
                    // Interpolate between this and previous percentile
                    const prevPercentile = percentiles[i - 1];
                    const prevLowerHeight = data.percentiles[prevPercentile][lowerIndex];
                    const prevUpperHeight = data.percentiles[prevPercentile][upperIndex];
                    const prevInterpolatedHeight = prevLowerHeight + ageFactor * (prevUpperHeight - prevLowerHeight);
                    
                    const heightFactor = (height - prevInterpolatedHeight) / (interpolatedHeight - prevInterpolatedHeight);
                    const estimatedPercentile = percentileValues[i - 1] + heightFactor * (percentileValues[i] - percentileValues[i - 1]);
                    
                    return `${Math.round(estimatedPercentile * 10) / 10}th`;
                }
            }
            
            return standard === 'who_cdc' ? '>97th' : '>99.6th';
        }

        function showInfo(message, type = 'info') {
            const infoDiv = document.getElementById('info');
            infoDiv.textContent = message;
            infoDiv.className = 'info-box' + (type === 'error' ? ' error' : '');
            infoDiv.style.display = 'block';
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load growth data first, then initialize chart
            loadGrowthData();
            
            // Update chart when standard or gender changes
            document.getElementById('standard').addEventListener('change', updateChart);
            document.getElementById('gender').addEventListener('change', updateChart);
        });
    </script>
</body>
</html> 